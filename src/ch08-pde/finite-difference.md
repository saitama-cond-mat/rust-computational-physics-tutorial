# 差分法の基礎

偏微分方程式をコンピュータで解くために、連続的な空間や時間を格子状に分割して離散化する手法を**差分法 (Finite Difference Method, FDM)** と呼びます。

## 離散化の表記

空間 $x$ を刻み幅 $Delta x$ で、時間 $t$ を刻み幅 $Delta t$ で分割します。
点 $(x_i, t_n) = (i Delta x, n Delta t)$ における関数の値を $u_i^n$ と表記します。

## 偏微分の差分近似

第3章で学んだ数値微分の手法を、偏微分にも適用します。

### 1階偏微分

- **時間に関する前進差分**:
  $$ pdv(u, t) approx (u_i^(n+1) - u_i^n) / (Delta t) $$
- **空間に関する中心差分**:
  $$ pdv(u, x) approx (u_(i+1)^n - u_(i-1)^n) / (2 Delta x) $$

### 2階偏微分

空間に関する2階微分（ラプラシアン）は、中心差分を用いて以下のように近似されます。

$$ pdv(u, x, 2) approx (u_(i+1)^n - 2u_i^n + u_(i-1)^n) / (Delta x^2) $$

![](../images/ch08/stencil.svg)

## 安定性と収束性

PDEの数値計算において最も重要な概念の一つが**安定性**です。
不適切な $Delta t$ や $Delta x$ の組み合わせを選ぶと、計算結果が指数関数的に増大して破綻（発散）してしまいます。

### CFL条件 (Courant-Friedrichs-Lewy Condition)

波動の伝播などを解く際、「数値的な情報の伝達速度が、物理的な波の速度を上回っていなければならない」という条件です。

$$ c Delta t / Delta x leq 1 $$

この条件を満たさない場合、計算は不安定になります。

## 境界条件

PDEを解くには、領域の端での振る舞いを指定する必要があります。

- **ディリクレ境界条件**: 境界での値を固定する（例：端の温度を $0$ 度に保つ）。
- **ノイマン境界条件**: 境界での微分係数（フラックス）を固定する（例：断熱条件 $pdv(u, x) = 0$）。
- **周期境界条件**: 右端と左端がつながっているとみなす。

<details>
<summary>補足: ノイマン境界条件の実装（ゴーストセル）</summary>

「端での傾き（微分）が0」という条件 $pdv(u, x) = 0$ を差分法で実装する場合、単純な前進・後退差分よりも、中心差分を使った方が精度が良くなります。

しかし、境界点（例えば $i=0$）で中心差分を取ろうとすると、領域外の点 $u_(-1)$ が必要になります。
$$ (u_1 - u_(-1)) / (2 Delta x) = 0 arrow.r u_(-1) = u_1 $$

このように、計算のためだけに導入する仮想的な格子点を**ゴーストセル (Ghost Cell)** と呼びます。
拡散方程式などの更新式において、$u_0$ を更新する際に $u_(-1)$ が出てきたら、それを $u_1$ で置き換えることで、自然にノイマン条件（断熱条件）を組み込むことができます。

プログラム上では、配列のインデックスを工夫するか、実際に配列サイズを少し大きく取ってゴーストセルを確保する実装が行われます。

</details>

---

[次節](./diffusion.md)では、具体例として拡散方程式を解いてみましょう。
